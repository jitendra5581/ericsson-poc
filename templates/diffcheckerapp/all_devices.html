{% extends 'diffcheckerapp/base.html' %}
{% load static %}
{% block content %}

<!-- Content start -->
<div class="content-header">
    <h1>
        All Devices
    </h1>
    <br>
    <table class="table table-hover">
        <thead>
          <tr>
            <th>Primary Device</th>
            <th>Secondary Device</th>
            <th>Download Report</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
         {% for qs in deveices_qs %}
            <tr>
            <td>{{qs.primary_interface.ip_address}}</td>
            <td>{{qs.ip_address}}</td>
            <td>
            <span class="btn btn-primary">
            <a class='scan-now' href="#">Scan Now</a>
          </span>
          </td>
            <td class="status"> 
              
              <i class="fa fa-window-close" aria-hidden="true"></i>
              
          </td>
          </tr>
          {% endfor %}
          
        </tbody>
      </table>
<!--------------code for modal popup --------------- -->  
<!-- Button trigger modal -->
<!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">
  Launch demo modal
</button> -->

<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h3 style="text-align: center;" class="modal-title" id="exampleModalLongTitle">Modified Device Configurations Report</h3>
        <h4 id='c_device' style="text-align: center; color:blue"></h4>
        <h4 id='scan-date' style="text-align: center; color:blue"></h4>
      </div>
      <div class="modal-body">
        <div class="col-report2">
         
      <h3>
        Deleted Configurations 
      </h3>
      <div id='deleted-contents'>
       
      </div>
      <h3>
        Added Configurations 
      </h3>
      <div id='added-contents'>
      
      </div>

      </div>
      </div>
      
    </div>
  </div>
</div>
<!--    --------------------------------------------   -->  

   </div>
<!-- end content -->
{% endblock %}

{% block extrajs %}
<script>
$(document).ready(
  function()
  {
  $('.scan-now').click(
    function()
    {
var $row = $(this).closest("tr"); 
$row.find(".status").html("<i class='fa fa-spinner fa-spin' aria-hidden='true' style='font-size:30px'></i>");
prim_ip = $row.find('td:eq(0)').html();
sec_ip = $row.find('td:eq(1)').html();
$.ajax(
  {
   url: '../scanner',
   type: 'GET',
   data: {
     'primary_ip': prim_ip,
     'secondary_ip' : sec_ip,
     "csrfmiddlewaretoken": '{{csrf_token}}'
  },
   success: function(result){
    if(result['status']=='done')
    {
      
      // $row.find(".status").html("<a data-toggle='modal' data-target='#exampleModalCenter'  href='#''> \
      //   <i class='fa fa-download' aria-hidden='true'></i> \
      //   </a>")   
      $row.find(".status").html("<a data-toggle='modal' data-target='#exampleModalCenter'  href='#''> \
        <i class='fa fa-check' aria-hidden='true'></i> \
        </a>")
      
    // ******************** code to fillup reports ****************
    var c_devices = "Device: "+
                     result['primary_ip']+
                     "<i class='fa fa-arrows-h' aria-hidden='true'></i>"+
                     result['secondary_ip'];
    
    $('#c_device').html(c_devices);

    // *******time stamp*************
    var currentdate = new Date(); 
    var datetime = "Scanned At : " + currentdate.getDate() + "/"
                + (currentdate.getMonth()+1)  + "/" 
                + currentdate.getFullYear() + " @ "  
                + currentdate.getHours() + ":"  
                + currentdate.getMinutes() + ":" 
                + currentdate.getSeconds();
    $('#scan-date').html(datetime); 
    
    var delete_p = '';
    $.each(result['deleted_config'], function(i, value){
       delete_p = delete_p + "<p style='background: #F1948A'>" + value + "</p>";
      }); 
    $('#deleted-contents').html(delete_p);  
     
    var added_p = '';
    $.each(result['added_config'], function(i, value){
      added_p = added_p + "<p style='background: #abf18a'>" + value + "</p>";
      }); 
    $('#added-contents').html(added_p);  
    $("#exampleModalCenter").modal('show');   

    }
   }
  });

    });
  });

</script>
{% endblock %}